<!DOCTYPE HTML><html lang="en"><head><title>DIY Flow Bench</title><meta name="viewport" content="width=device-width,initial-scale=1"><style>body,html{height:100vh;margin:0;font-family:Arial;font-size:22px;background-color:#fff;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='562' height='468.3' viewBox='0 0 1080 900'%3E%3Cg fill-opacity='0.03'%3E%3Cpolygon fill='%23444' points='90 150 0 300 180 300'/%3E%3Cpolygon points='90 150 180 0 0 0'/%3E%3Cpolygon fill='%23AAA' points='270 150 360 0 180 0'/%3E%3Cpolygon fill='%23DDD' points='450 150 360 300 540 300'/%3E%3Cpolygon fill='%23999' points='450 150 540 0 360 0'/%3E%3Cpolygon points='630 150 540 300 720 300'/%3E%3Cpolygon fill='%23DDD' points='630 150 720 0 540 0'/%3E%3Cpolygon fill='%23444' points='810 150 720 300 900 300'/%3E%3Cpolygon fill='%23FFF' points='810 150 900 0 720 0'/%3E%3Cpolygon fill='%23DDD' points='990 150 900 300 1080 300'/%3E%3Cpolygon fill='%23444' points='990 150 1080 0 900 0'/%3E%3Cpolygon fill='%23DDD' points='90 450 0 600 180 600'/%3E%3Cpolygon points='90 450 180 300 0 300'/%3E%3Cpolygon fill='%23666' points='270 450 180 600 360 600'/%3E%3Cpolygon fill='%23AAA' points='270 450 360 300 180 300'/%3E%3Cpolygon fill='%23DDD' points='450 450 360 600 540 600'/%3E%3Cpolygon fill='%23999' points='450 450 540 300 360 300'/%3E%3Cpolygon fill='%23999' points='630 450 540 600 720 600'/%3E%3Cpolygon fill='%23FFF' points='630 450 720 300 540 300'/%3E%3Cpolygon points='810 450 720 600 900 600'/%3E%3Cpolygon fill='%23DDD' points='810 450 900 300 720 300'/%3E%3Cpolygon fill='%23AAA' points='990 450 900 600 1080 600'/%3E%3Cpolygon fill='%23444' points='990 450 1080 300 900 300'/%3E%3Cpolygon fill='%23222' points='90 750 0 900 180 900'/%3E%3Cpolygon points='270 750 180 900 360 900'/%3E%3Cpolygon fill='%23DDD' points='270 750 360 600 180 600'/%3E%3Cpolygon points='450 750 540 600 360 600'/%3E%3Cpolygon points='630 750 540 900 720 900'/%3E%3Cpolygon fill='%23444' points='630 750 720 600 540 600'/%3E%3Cpolygon fill='%23AAA' points='810 750 720 900 900 900'/%3E%3Cpolygon fill='%23666' points='810 750 900 600 720 600'/%3E%3Cpolygon fill='%23999' points='990 750 900 900 1080 900'/%3E%3Cpolygon fill='%23999' points='180 0 90 150 270 150'/%3E%3Cpolygon fill='%23444' points='360 0 270 150 450 150'/%3E%3Cpolygon fill='%23FFF' points='540 0 450 150 630 150'/%3E%3Cpolygon points='900 0 810 150 990 150'/%3E%3Cpolygon fill='%23222' points='0 300 -90 450 90 450'/%3E%3Cpolygon fill='%23FFF' points='0 300 90 150 -90 150'/%3E%3Cpolygon fill='%23FFF' points='180 300 90 450 270 450'/%3E%3Cpolygon fill='%23666' points='180 300 270 150 90 150'/%3E%3Cpolygon fill='%23222' points='360 300 270 450 450 450'/%3E%3Cpolygon fill='%23FFF' points='360 300 450 150 270 150'/%3E%3Cpolygon fill='%23444' points='540 300 450 450 630 450'/%3E%3Cpolygon fill='%23222' points='540 300 630 150 450 150'/%3E%3Cpolygon fill='%23AAA' points='720 300 630 450 810 450'/%3E%3Cpolygon fill='%23666' points='720 300 810 150 630 150'/%3E%3Cpolygon fill='%23FFF' points='900 300 810 450 990 450'/%3E%3Cpolygon fill='%23999' points='900 300 990 150 810 150'/%3E%3Cpolygon points='0 600 -90 750 90 750'/%3E%3Cpolygon fill='%23666' points='0 600 90 450 -90 450'/%3E%3Cpolygon fill='%23AAA' points='180 600 90 750 270 750'/%3E%3Cpolygon fill='%23444' points='180 600 270 450 90 450'/%3E%3Cpolygon fill='%23444' points='360 600 270 750 450 750'/%3E%3Cpolygon fill='%23999' points='360 600 450 450 270 450'/%3E%3Cpolygon fill='%23666' points='540 600 630 450 450 450'/%3E%3Cpolygon fill='%23222' points='720 600 630 750 810 750'/%3E%3Cpolygon fill='%23FFF' points='900 600 810 750 990 750'/%3E%3Cpolygon fill='%23222' points='900 600 990 450 810 450'/%3E%3Cpolygon fill='%23DDD' points='0 900 90 750 -90 750'/%3E%3Cpolygon fill='%23444' points='180 900 270 750 90 750'/%3E%3Cpolygon fill='%23FFF' points='360 900 450 750 270 750'/%3E%3Cpolygon fill='%23AAA' points='540 900 630 750 450 750'/%3E%3Cpolygon fill='%23FFF' points='720 900 810 750 630 750'/%3E%3Cpolygon fill='%23222' points='900 900 990 750 810 750'/%3E%3Cpolygon fill='%23222' points='1080 300 990 450 1170 450'/%3E%3Cpolygon fill='%23FFF' points='1080 300 1170 150 990 150'/%3E%3Cpolygon points='1080 600 990 750 1170 750'/%3E%3Cpolygon fill='%23666' points='1080 600 1170 450 990 450'/%3E%3Cpolygon fill='%23DDD' points='1080 900 1170 750 990 750'/%3E%3C/g%3E%3C/svg%3E")}.tablink{background-color:#555;color:#fff;float:left;border:none;outline:0;cursor:pointer;padding:18px 1pc;font-size:22px;width:33.3333%}.tablink:active,.tablink:hover{background-color:#777}#tabcontainer{padding:75pt 20px 20px}.tabcontentMain{display:block}.tabcontentConfig{display:none;margin-bottom:60px}.tabcontentData{display:none}#About,#Contact,#Home,#News{background-color:#fff}html{font-family:Helvetica;display:inline-block;margin:0 auto}.headerbar{overflow:hidden;background-color:#0a1128;text-align:center}.headerbar h1 a:active,.headerbar h1 a:hover,.headerbar h1 a:link,.headerbar h1 a:visited{color:#fff;text-decoration:none;font-size:44px;font-weight:700}h1{font-size:30px}h2{font-size:26px;margin-bottom:14px}h3{font-size:20px}p{font-size:1.5rem}a:active,a:link,a:visited{color:#0a1128;text-decoration:none}a:hover{color:#666;text-decoration:none}hr{clear:both}.content{padding:30px}.float-right{float:right}.align-center{text-align:center}.clear-both{clear:both}.tile-grid{max-width:700px;margin:0 auto;display:grid;grid-gap:2rem;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr))}.tile{background-color:#fff;box-shadow:2px 2px 9pt 1px #666;text-align:center}.tile-title{font-size:1rem;font-weight:700;color:#034078;cursor:pointer}.tile-value{font-size:2.1rem;font-weight:700;color:#333}#FDIFFTYPEDESC{cursor:pointer}.flowTargetVal{font-weight:700;font-size:2.1rem;color:#333;cursor:pointer}flowTargetValInput{font-size:22px}#aflow-tile,#maf-tile,#tile-fdiff,#tile-pdiff,#tile-swirl{display:none}.config-panel{max-width:650px;margin:auto}.config-row{margin-top:5px}.config-label{padding-left:5px}.config-value{padding-right:50px;width:300px;float:right}.config-text{width:200px;float:right}.config-select{width:13pc;float:right}.units{font-size:.8rem;color:#666}.status_message{font-size:1.2rem;color:#666;margin-bottom:28px}#footer{clear:both;text-align:center}.hidden_div{display:none}.control-button{height:70px}.button,.control-button{display:inline-block;padding:9pt;font-size:22px;width:150px}.button,.button-sml,.control-button{background-color:#008cba;border:none;border-radius:4px;color:#fff;text-decoration:none;margin:2px;cursor:pointer}.button-sml{float:right;padding:6px;font-size:9pt}#clear-graph-data-button,#record-button{background-color:#fa7b04}#export-graph-data-button{background-color:#2ca909}#load-graph-data-button{background-color:#125ab1}#save-graph-data-button{background-color:#fa7b04}#calibrate-button{background-color:#fa2e04}#clear-message-button{background-color:#999}#file-manager-button,#info-button,#restart-button,#support-button,#update-button{width:110px;height:50px}#on-button{background-color:#44b112}#delete-button,#off-button,#restart-button{background-color:#fa2e04}#upload-form{float:right}.tooltip{position:relative;border-bottom:1px dotted #000}.tooltip .tooltiptext{visibility:hidden;width:350px;background-color:#666;color:#fff;text-align:center;border-radius:6px;padding:5px;position:absolute;z-index:1;left:-10px;top:-5px}.tooltip .tooltiptext:after{content:"";position:absolute;top:100vh;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:#000 transparent transparent}.tooltip:hover .tooltiptext{visibility:visible}.modal{display:none;position:fixed;z-index:1;left:0;padding-top:50px;width:100vw;height:100vh;overflow:auto;background-color:#000;background-color:rgba(0,0,0,.4)}.modal-content{background-color:#fefefe;margin:1px auto;padding:20px;border:1px solid #888;width:850px;border-radius:5px}.calibrationModal{width:25pc}@media screen and (max-width:800px){.modal-content{width:100vw}}.file-upload-button{padding:9pt 0;text-align:center}.file-submit-button{padding:9pt 0;text-align:center;font-size:15px;padding:6px}.input_container{border:1px solid #e5e5e5}input[type=file]::file-selector-button{background-color:#fff;color:#000;border:0;border-right:1px solid #e5e5e5;padding:10px 15px;margin-right:20px;transition:.5s}input[type=file]::file-selector-button:hover{background-color:#eee;border:0;border-right:1px solid #e5e5e5}.closeCalibrationModalButton,.closeCaptureLiftDataModalButton,.closeExportGraphDataModalButton,.closeFileModalButton,.closeInfoModalButton,.closeLoadGraphDataModalButton,.closeSaveGraphDataModalButton,closeFlowTargetModalButton,closeUpdateModalButton{color:#aaa;float:right;font-size:22px;font-weight:700;cursor:pointer}.closeCalibrationModalButton:focus,.closeCalibrationModalButton:hover,.closeCaptureLiftDataModalButton:focus,.closeCaptureLiftDataModalButton:hover,.closeFileModalButton:focus,.closeFileModalButton:hover,.closeFlowTargetModalButton:focus,.closeFlowTargetModalButton:hover,.closeInfoModalButton:focus,.closeInfoModalButton:hover,.closeLoadGraphDataModalButton:focus,.closeLoadGraphDataModalButton:hover,.closeSaveGraphDataModalButton:focus,.closeSaveGraphDataModalButton:hover,.closeUpdateModalButton:focus,.closeUpdateModalButton:hover{color:#000;text-decoration:none;cursor:pointer}.fileSizeTxt{padding:10px}.fileDelLink{padding:10px;left:75pt}.file-link,.fileDelLink{cursor:pointer}.fileListRow{margin-bottom:10px}.column{float:left;height:40px}.left{width:350px;height:40px}.middle{width:200px}.right{width:75pt}.row:after{content:"";display:table;clear:both}.graph-container{margin-top:50px;text-align:center}svg.graph{height:600px!important;width:750px!important;background-color:#fff;padding-top:75pt;box-shadow:2px 2px 9pt 1px #666;stroke-linejoin:round}svg.graph .grid{stroke:grey;stroke-dasharray:1 2;stroke-width:1}svg.graph .points{stroke-width:3}svg.graph .first_set{fill:#00554d}svg.graph .surfaces{fill-opacity:.5}svg.graph .grid.double{stroke-opacity:.4}svg.graph .labels{font-family:Arial;font-size:14px;kerning:1}svg.graph .labels.x-labels{text-anchor:middle}svg.graph .labels.y-labels{text-anchor:end}.hide{display:none}.dataCircle:hover+.hide{display:block;z-index:2}svg .dataCircle:hover{r:6}.dataCircle{position:relative;opacity:.25}.dataValue{text-anchor:middle;font-size:14px;color:#000;transition:font-size .5s,opacity .3s}.prefTestOK{color:#90ee90}.prefTestNOK,.prefTestOK{font-size:2.1rem;font-weight:700}.prefTestNOK{color:red}.switch-field{margin-top:18px;margin-bottom:18px}.switch-field input{position:absolute!important;clip:rect(0,0,0,0);height:1px;width:1px;border:0;overflow:hidden}.switch-field label{background-color:#989898;color:#fff;font-size:20px;line-height:1;text-align:center;padding:8px;margin-right:-1px;box-shadow:inset 0 1px 3px rgba(0,0,0,.3),0 1px hsla(0,0%,100%,.1);transition:all .1s ease-in-out}.switch-field label:hover{cursor:pointer}.switch-field input:checked+label{background-color:#44b113;box-shadow:none}.switch-field label:first-of-type{border-radius:4px 0 0 4px}.switch-field label:last-of-type{border-radius:0 4px 4px 0}.form{max-width:600px;font-family:Lucida Grande,Tahoma,Verdana,sans-serif;font-weight:400;line-height:1.625;margin:8px auto;padding:1pc}#orifice-data{font-size:22px;color:#666;margin-bottom:18px}</style></head><body><input type="hidden" id="ACTIVE_ORIFICE" value=""><input type="hidden" id="BENCH_TYPE" value=""><div id="captureLiftDataModal" class="modal"><div class="modal-content"><span class="closeCaptureLiftDataModalButton">&times;</span><h3>Select lift value before capture</h3><hr><div class="align-center"><form method="POST" action="/api/saveliftdata" enctype="multipart/form-data"><label>Lift Value</label><br><div class="switch-field"><input type="radio" id="lift-one" name="lift-data" value="1" checked="checked"> <label for="lift-one">~lift1~</label> <input type="radio" id="lift-two" name="lift-data" value="2"> <label for="lift-two">~lift2~</label> <input type="radio" id="lift-three" name="lift-data" value="3"> <label for="lift-three">~lift3~</label> <input type="radio" id="lift-four" name="lift-data" value="4"> <label for="lift-four">~lift4~</label> <input type="radio" id="lift-five" name="lift-data" value="5"> <label for="lift-five">~lift5~</label> <input type="radio" id="lift-six" name="lift-data" value="6"> <label for="lift-six">~lift6~</label> <input type="radio" id="lift-seven" name="lift-data" value="7"> <label for="lift-seven">~lift7~</label> <input type="radio" id="lift-eight" name="lift-data" value="8"> <label for="lift-eight">~lift8~</label> <input type="radio" id="lift-nine" name="lift-data" value="9"> <label for="lift-nine">~lift9~</label> <input type="radio" id="lift-ten" name="lift-data" value="10"> <label for="lift-ten">~lift10~</label> <input type="radio" id="lift-eleven" name="lift-data" value="11"> <label for="lift-eleven">~lift11~</label> <input type="radio" id="lift-twelve" name="lift-data" value="12"> <label for="lift-twelve">~lift12~</label></div><input id="data" type="file" name="wtf"> <input class="button submit-button" type="submit" id="capture-lift-data-button" value="Capture"></form></div><div class="clear-both">&nbsp;</div></div></div><div id="updateModal" class="modal"><div class="modal-content updateModal"><span class="closeUpdateModalButton">&times;</span><div class="align-center"><h3>Upload Firmware Binary (firmware.bin)</h3><hr><br><form method="POST" action="/api/update" enctype="multipart/form-data"><div class="input_container"><input type="file" name="update" id="fileUpload"> <input type="submit" value="Update" class="button file-submit-button"></div></form></div></div></div><div id="flowTargetModal" class="modal"><div class="modal-content flowTargetModal"><span class="closeFlowTargetModalButton">&times;</span><div class="align-center"><form method="POST" action="/api/saveflowtarget" enctype="multipart/form-data"><label>User Flow Target Value</label> <input id="flowTargetValInput" type="text" name="USER_OFFSET" value="~USER_OFFSET~"> <input class="button submit-button" type="submit" value="Save"></form></div></div></div><div id="calibrationModal" class="modal"><div class="modal-content calibrationModal"><span class="closeCalibrationModalButton">&times;</span><div class="align-center"><button id="calibrate-button" class="button">Calibrate Flow Offset</button> <button id="leak-cal-button" class="button">Calibrate Leak Test</button></div></div></div><div id="loadGraphDataModal" class="modal"><div class="modal-content"><span class="closeLoadGraphDataModalButton">&times;</span><h3>Load Lift Profile</h3><hr><br><div class="float-right"><form method="POST" action="/api/viewdata" enctype="multipart/form-data"><input class="button file-submit-button" type="submit" value="Load"></form></div><div class="clear-both">&nbsp;</div></div></div><div id="saveGraphDataModal" class="modal"><div class="modal-content"><span class="closeSaveGraphDataModalButton">&times;</span><h3>Save Lift Data</h3><hr><br><div class="float-right"><form method="POST" action="/api/savedata" enctype="multipart/form-data"><label class="config-label">Filename:</label>&nbsp;<input type="text" value="~FileName~"> <input class="button file-submit-button" type="submit" value="Load"></form></div><div class="clear-both">&nbsp;</div></div></div><div id="fileModal" class="modal"><div class="modal-content"><span class="closeFileModalButton">&times;</span><h3>File Manager</h3><div id="file_list">~FILE_LIST~</div><br><hr><br><div class="float-right"><form method="POST" action="/api/file/upload" enctype="multipart/form-data"><div class="input_container"><input type="file" name="upload" id="fileUpload"> <input type="submit" value="Upload" class="button file-submit-button"></div></form></div><div class="clear-both">&nbsp;</div></div></div><div id="infoModal" class="modal"><div class="modal-content"><span class="closeInfoModalButton">&times;</span><h3>DIY Flow Bench</h3><h4>Firmware</h4><hr><div class="config-row"><label class="config-label">Version:</label><span class="config-value" id="RELEASE">~RELEASE~</span></div><div class="config-row"><label class="config-label">Build:</label><span class="config-value" id="BUILD_NUMBER">~BUILD_NUMBER~</span></div><h4>Storage</h4><hr><div class="config-row"><label class="config-label">Memory Size:</label><span class="config-value" id="SPIFFS_MEM_SIZE">~SPIFFS_MEM_SIZE~</span> (bytes)</div><div class="config-row"><label class="config-label">Memory Used:</label><span class="config-value" id="SPIFFS_MEM_USED">~SPIFFS_MEM_USED~</span> (bytes)</div><h4>Network</h4><hr><div class="config-row"><label class="config-label">IP Address:</label><span class="config-value" id="LOCAL_IP_ADDRESS">~LOCAL_IP_ADDRESS~</span></div><div class="config-row"><label class="config-label">Hostname:</label><span class="config-value" id="HOSTNAME">http://~HOSTNAME~.local</span></div><h4>Hardware Configuration</h4><hr><div class="config-row"><label class="config-label">Bench Type:</label><span class="config-value" id="BENCH_TYPE">~BENCH_TYPE~</span></div><div class="config-row"><label class="config-label">Board Type:</label><span class="config-value" id="BOARD_TYPE">~BOARD_TYPE~</span></div><h4>Sensor Configuration</h4><hr><div class="config-row"><label class="config-label">MAF Data File:</label><span class="config-value" id="MAF_SENSOR">~MAF_SENSOR~</span></div><div class="config-row"><label class="config-label">Ref Press Sensor:</label><span class="config-value" id="PREF_SENSOR">~PREF_SENSOR~</span></div><div class="config-row"><label class="config-label">Temp Sensor:</label><span class="config-value" id="TEMP_SENSOR">~TEMP_SENSOR~</span></div><div class="config-row"><label class="config-label">Humidity Sensor:</label><span class="config-value" id="RELH_SENSOR">~RELH_SENSOR~</span></div><div class="config-row"><label class="config-label">Baro Sensor:</label><span class="config-value" id="BARO_SENSOR">~BARO_SENSOR~</span></div><div class="config-row"><label class="config-label">Pitot Sensor:</label><span class="config-value" id="PITOT_SENSOR">~PITOT_SENSOR~</span></div><div class="config-row"><label class="config-label">Differential Sensor:</label><span class="config-value" id="PDIFF_SENSOR">~PDIFF_SENSOR~</span></div></div></div><div class="headerbar"><h1><a href="/" id="PAGE_TITLE" alt="DIY Flow Bench">DIY Flow Bench</a></h1></div><button class="tablink" onclick="openTab('dashboard', this)" id="load-dashboard-button">Dashboard</button> <button class="tablink" onclick="openTab('datalog', this)" id="load-datalog-button">Data</button> <button class="tablink" onclick="openTab('configuration', this)" id="load-config-button">Configuration</button><div id="tabcontainer"><div id="dashboard" class="tabcontent tabcontentMain"><div class="content"><div class="tile-grid"><div class="tile tile-pref" id="tile-pref"><p class="tile-title" id="tile-pref-title">Depression</p><p><span class="tile-value" id="PREF">&nbsp;</span></p><p class="units">inH2O</p></div><div class="tile tile-pdiff" id="tile-pdiff"><p class="tile-title" id="tile-pdiff-title">Diff Pressure</p><p><span class="tile-value" id="PDIFF">&nbsp;</span></p><p class="units">inH2O</p></div><div class="tile tile-flow" id="flow-tile"><p class="tile-title" id="flow-tile-title">Flow Rate</p><p><span class="tile-value" id="FLOW">&nbsp;</span></p><p class="units">ACFM</p></div><div class="tile tile-aflow" id="aflow-tile"><p class="tile-title" id="aflow-tile-title">Adjusted Flow</p><p><span class="tile-value" id="AFLOW">&nbsp;</span></p><p class="units">ACFM&nbsp;&commat;&nbsp;<span id="PADJUST">28</span>&nbsp;inH2O</p></div><div class="tile tile-flow" id="maf-tile"><p class="tile-title" id="maf-tile-title">MAF Flow</p><p><span class="tile-value" id="MFLOW">&nbsp;</span></p><p class="units">KGH</p></div><div class="tile tile-pitot" id="tile-pitot"><p class="tile-title" id="tile-pitot-title">Pitot</p><p><span class="tile-value" id="PITOT">&nbsp;</span></p><p class="units">inH2O</p></div><div class="tile tile-swirl" id="tile-swirl"><p class="tile-title" id="tile-swirl-title">Swirl</p><p><span class="tile-value" id="SWIRL">&nbsp;</span></p><p class="units">rpm</p></div><div class="tile tile-fdiff" id="tile-fdiff"><p class="tile-title" id="tile-fdiff-title">Flow Diff</p><p><span class="tile-value flowTargetVal" id="FDIFF">&nbsp;</span></p><p class="units"><span id="FDIFFTYPEDESC">~FDIFFTYPEDESC~</span></p></div><div class="tile tile-temp" id="tile-temp"><p class="tile-title" id="tile-temp-title">Temperature</p><p><span class="tile-value" id="TEMP">&nbsp;</span></p><p class="units">~TEMP_UNIT~</p></div><div class="tile tile-baro" id="tile-baro"><p class="tile-title" id="tile-baro-title">Baro Pressure</p><p><span class="tile-value" id="BARO">&nbsp;</span></p><p class="units">millibar (hPa)</p></div><div class="tile tile-relh" id="tile-relh"><p class="tile-title" id="tile-relh-title">Humidity</p><p><span class="tile-value" id="RELH">&nbsp;</span></p><p class="units">&percnt;RelH</p></div></div></div><div class="align-center"><div class="status_message"><span id="STATUS_MESSAGE">~STATUS_MESSAGE~</span></div><div class="hidden_div"><br>Ref Pressure mV: <span id="PREF_MV">&nbsp;</span><br>MAF mV: <span id="MAF_MV">&nbsp;</span><br>Pitot mV: <span id="PITOT_MV">&nbsp;</span></div><form method="POST" id="orificeRadio" style="display: none;"><div class="switch-field"><input type="radio" id="orifice1" name="radioOrifice" value="1" ~orifice1_checked~ onchange="orificeChange(this);"> <label for="orifice1">1</label> <input type="radio" id="orifice2" name="radioOrifice" value="2" ~orifice2_checked~ onchange="orificeChange(this);"> <label for="orifice2">2</label> <input type="radio" id="orifice3" name="radioOrifice" value="3" ~orifice3_checked~ onchange="orificeChange(this);"> <label for="orifice3">3</label> <input type="radio" id="orifice4" name="radioOrifice" value="4" ~orifice4_checked~ onchange="orificeChange(this);"> <label for="orifice4">4</label> <input type="radio" id="orifice5" name="radioOrifice" value="5" ~orifice5_checked~ onchange="orificeChange(this);"> <label for="orifice5">5</label> <input type="radio" id="orifice6" name="radioOrifice" value="6" ~orifice6_checked~ onchange="orificeChange(this);"> <label for="orifice6">6</label></div><div id="orifice-data">Calibrated Flow Rate: <span id="ORIFICE_MAX_FLOW">~ORIFICE_MAX_FLOW~</span>cfm @ <span id="ORIFICE_CALIBRATED_DEPRESSION">~ORIFICE_CALIBRATED_DEPRESSION~</span> inH2O"</div></form><button id="on-button" class="control-button">START BENCH</button> <button id="off-button" class="control-button">STOP BENCH</button> <button id="clear-message-button" class="control-button">CLEAR ALARM</button><br><button id="show-capture-modal-button" class="control-button">CAPTURE</button></div></div><div id="datalog" class="tabcontent tabcontentData"><div class="graph-container"><svg class="graph" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" id="dataGraph" style="background-color: #fff; padding-top: 100px;"><g class="grid x-grid" id="xGrid" style="stroke: grey; stroke-dasharray: 1 2; stroke-width: 1;"><line x1="100" x2="100" y1="0" y2="510"></line><line x1="150" x2="150" y1="0" y2="510"></line><line x1="200" x2="200" y1="0" y2="510"></line><line x1="250" x2="250" y1="0" y2="510"></line><line x1="300" x2="300" y1="0" y2="510"></line><line x1="350" x2="350" y1="0" y2="510"></line><line x1="400" x2="400" y1="0" y2="510"></line><line x1="450" x2="450" y1="0" y2="510"></line><line x1="500" x2="500" y1="0" y2="510"></line><line x1="550" x2="550" y1="0" y2="510"></line><line x1="600" x2="600" y1="0" y2="510"></line><line x1="650" x2="650" y1="0" y2="510"></line><line x1="700" x2="700" y1="0" y2="510"></line></g><g class="grid y-grid" id="yGrid" style="stroke: grey; stroke-dasharray: 1 2; stroke-width: 1;"><line x1="90" x2="700" y1="0" y2="0"></line><line x1="90" x2="700" y1="50" y2="50"></line><line x1="90" x2="700" y1="100" y2="100"></line><line x1="90" x2="700" y1="150" y2="150"></line><line x1="90" x2="700" y1="200" y2="200"></line><line x1="90" x2="700" y1="250" y2="250"></line><line x1="90" x2="700" y1="300" y2="300"></line><line x1="90" x2="700" y1="350" y2="350"></line><line x1="90" x2="700" y1="400" y2="400"></line><line x1="90" x2="700" y1="450" y2="450"></line><line x1="90" x2="700" y1="500" y2="500"></line></g><g class="labels x-labels"><text x="100" y="550">Lift:</text><text x="150" y="550">~lift1~</text><text x="200" y="550">~lift2~</text><text x="250" y="550">~lift3~</text><text x="300" y="550">~lift4~</text><text x="350" y="550">~lift5~</text><text x="400" y="550">~lift6~</text><text x="450" y="550">~lift7~</text><text x="500" y="550">~lift8~</text><text x="550" y="550">~lift9~</text><text x="600" y="550">~lift10~</text><text x="650" y="550">~lift11~</text><text x="700" y="550">~lift12~</text></g><g class="labels y-labels"><text x="80" y="10">~flow10~</text><text x="80" y="60">~flow9~</text><text x="80" y="110">~flow8~</text><text x="80" y="160">~flow7~</text><text x="80" y="210">~flow6~</text><text x="80" y="260">~flow5~</text><text x="80" y="310">~flow4~</text><text x="80" y="360">~flow3~</text><text x="80" y="410">~flow2~</text><text x="80" y="460">~flow1~</text><text x="80" y="510">Flow (cfm)</text></g><g class="labels key-labels"></g><g class="surfaces" id="lineData"><polyline fill="none" stroke="#000" stroke-width="1" stroke-dasharray="4, 1" points="100,500 150,~LINE_DATA1~ 200,~LINE_DATA2~ 250,~LINE_DATA3~ 300,~LINE_DATA4~ 350,~LINE_DATA5~ 400,~LINE_DATA6~ 450,~LINE_DATA7~ 500,~LINE_DATA8~ 550,~LINE_DATA9~ 600,~LINE_DATA10~ 650,~LINE_DATA11~ 700,~LINE_DATA12~"/></g><use class="grid double" xlink:href="#xGrid"></use><use class="grid double" xlink:href="#yGrid"></use></svg></div><div class="align-center"><br><button id="clear-graph-data-button" class="control-button">CLEAR</button> <button id="export-graph-data-button" class="control-button">EXPORT</button> <button id="capture-graph-data-button" class="control-button">IMAGE</button> <a href="/api/file/download/liftdata.json" download id="file-data-download" hidden></a></div></div><div id="configuration" class="tabcontent tabcontentConfig"><div class="config-panel"><p style="text-align:center"><button id="file-manager-button" class="button">Files</button> <button id="info-button" class="button">Info</button> <button id="support-button" class="button" onclick="window.open('https://github.com/DeeEmm/DIY-Flow-Bench/wiki','_blank')">Support</button> <button id="restart-button" class="button">Reboot</button> <button id="update-button" class="button">Update</button></p><br><form method="POST" action="/api/saveconfig"><h2>System Settings</h2><h3>WiFi Info</h3><div class="config-row tooltip"><label class="config-label">WiFi SSID:</label>&nbsp;<input type="text" id="CONF_WIFI_SSID" name="CONF_WIFI_SSID" value="~CONF_WIFI_SSID~" class="config-text"><span class="tooltiptext">The name of your WiFi network</span></div><div class="config-row tooltip"><label class="config-label">WiFi Password:</label>&nbsp;<input type="text" id="CONF_WIFI_PSWD" name="CONF_WIFI_PSWD" value="~CONF_WIFI_PSWD~" class="config-text"><span class="tooltiptext">Your WiFi Password</span></div><div class="config-row tooltip"><label class="config-label">WiFi AP SSID:</label>&nbsp;<input type="text" id="CONF_WIFI_AP_SSID" name="CONF_WIFI_AP_SSID" value="~CONF_WIFI_AP_SSID~" class="config-text"><span class="tooltiptext">Access-Point name for direct WiFi connection</span></div><div class="config-row tooltip"><label class="config-label">WiFi AP Password:</label>&nbsp;<input type="text" id="CONF_WIFI_AP_PSWD" name="CONF_WIFI_AP_PSWD" value="~CONF_WIFI_AP_PSWD~" class="config-text"><span class="tooltiptext">Access-Point password</span></div><div class="config-row tooltip"><label class="config-label">Hostname:</label>&nbsp;<input type="text" id="CONF_HOSTNAME" name="CONF_HOSTNAME" value="~CONF_HOSTNAME~" class="config-text"><span class="tooltiptext">DNS Hostname (used for connecting via URL e.g. http://diyfb.local)</span></div><div class="config-row tooltip"><label class="config-label">WiFi Timeout:</label>&nbsp;<input type="text" id="CONF_WIFI_TIMEOUT" name="CONF_WIFI_TIMEOUT" value="~CONF_WIFI_TIMEOUT~" class="config-text"><span class="tooltiptext">Number of milliseconds before WiFi retries connection</span></div><br><h3>API Settings</h3><div class="config-row tooltip"><label class="config-label">API Delimiter:</label>&nbsp;<input type="text" id="CONF_API_DELIM" name="CONF_API_DELIM" value="~CONF_API_DELIM~" class="config-text"><span class="tooltiptext">Character used to delimit API / Serial data</span></div><div class="config-row tooltip"><label class="config-label">Serial Baud Rate:</label>&nbsp;<input type="text" id="CONF_SERIAL_BAUD_RATE" name="CONF_SERIAL_BAUD_RATE" value="~CONF_SERIAL_BAUD_RATE~" class="config-text"><span class="tooltiptext">Baud rate for serial communication</span></div><br><h3>Resolution and Accuracy</h3><div class="config-row tooltip"><label class="config-label">Rounding:</label><span>~ROUNDING_TYPE_DROPDOWN~</span><span class="tooltiptext">Rounding used in flow calculations</span></div><div class="config-row tooltip"><label class="config-label">Flow Decimal Accuracy:</label><span>~FLOW_DECIMAL_LENGTH_DROPDOWN~</span><span class="tooltiptext">Number of decimal places used in UI for flow values</span></div><div class="config-row tooltip"><label class="config-label">General Decimal Accuracy:</label><span>~GEN_DECIMAL_LENGTH_DROPDOWN~</span><span class="tooltiptext">Number of decimal places used in UI</span></div><br><h3>Data Filters</h3><div class="config-row tooltip"><label class="config-label">Data Filter Type:</label><span>~DATA_FILTER_TYPE_DROPDOWN~</span><span class="tooltiptext">Select data filter type</span></div><div class="config-row tooltip"><label class="config-label">Min Flow Rate:</label>&nbsp;<input type="text" id="CONF_MIN_FLOW_RATE" name="CONF_MIN_FLOW_RATE" value="~CONF_MIN_FLOW_RATE~" class="config-text"><span class="tooltiptext">Used to filter out non-zero flow values when bench is not running</span></div><div class="config-row tooltip"><label class="config-label">Min Bench Pressure:</label>&nbsp;<input type="text" id="CONF_MIN_BENCH_PRESSURE" name="CONF_MIN_BENCH_PRESSURE" value="~CONF_MIN_BENCH_PRESSURE~" class="config-text"><span class="tooltiptext">Minimum reference pressure that bench is considered running</span></div><div class="config-row tooltip"><label class="config-label">MAF Min volts:</label>&nbsp;<input type="text" id="CONF_MAF_MIN_VOLTS" name="CONF_MAF_MIN_VOLTS" value="~CONF_MAF_MIN_VOLTS~" class="config-text"><span class="tooltiptext">Minimum MAF voltage that bench is considered running</span></div><div class="config-row tooltip"><label class="config-label">Cyclical Average Buffer:</label>&nbsp;<input type="text" id="CONF_CYCLIC_AVERAGE_BUFFER" name="CONF_CYCLIC_AVERAGE_BUFFER" value="~CONF_CYCLIC_AVERAGE_BUFFER~" class="config-text"><span class="tooltiptext">Mean buffer size - Used for smoothing results.</span></div><br><h3>Bench Settings</h3><div class="config-row tooltip"><label class="config-label">Bench Type:</label><span>~BENCH_TYPE_DROPDOWN~</span><span class="tooltiptext">Select bench type</span></div><div class="config-row tooltip"><label class="config-label">MAF Housing Diameter:</label>&nbsp;<input type="text" id="CONF_MAF_HOUSING_DIAMETER" name="CONF_MAF_HOUSING_DIAMETER" value="~CONF_MAF_HOUSING_DIAMETER~" class="config-text"><span class="tooltiptext">Diameter of MAF Housing. (Leave as zero to use standard housing diameter)</span></div><div class="config-row tooltip"><label class="config-label">Refresh Rate:</label>&nbsp;<input type="text" id="CONF_REFRESH_RATE" name="CONF_REFRESH_RATE" value="~CONF_REFRESH_RATE~" class="config-text"><span class="tooltiptext">Screen refresh rate in milliseconds</span></div><div class="config-row tooltip"><label class="config-label">Conversion Depression:</label>&nbsp;<input type="text" id="ADJ_FLOW_DEPRESSION" name="ADJ_FLOW_DEPRESSION" value="~ADJ_FLOW_DEPRESSION~" class="config-text"><span class="tooltiptext">Bench depression used for adjusted flow calcs</span></div><div class="config-row tooltip"><label class="config-label">Temperature Unit:</label><span>~TEMPERATURE_DROPDOWN~</span><span class="tooltiptext">Display unit of temperature</span></div><div class="config-row tooltip"><label class="config-label">Valve Lift Interval:</label>&nbsp;<input type="text" id="VALVE_LIFT_INTERVAL" name="VALVE_LIFT_INTERVAL" value="~VALVE_LIFT_INTERVAL~" class="config-text"><span class="tooltiptext">Distance between valve lift data points</span></div><br><h3>Calibration Orifice Settings</h3><div class="config-row tooltip"><label class="config-label">Calibration Orifice Flow Rate:</label>&nbsp;<input type="text" id="CONF_CAL_FLOW_RATE" name="CONF_CAL_FLOW_RATE" value="~CONF_CAL_FLOW_RATE~" class="config-text"><span class="tooltiptext">Flow rate of calibration orifice in cfm</span></div><div class="config-row tooltip"><label class="config-label">Calibration Orifice Test Pressure:</label>&nbsp;<input type="text" id="CONF_CAL_REF_PRESS" name="CONF_CAL_REF_PRESS" value="~CONF_CAL_REF_PRESS~" class="config-text"><span class="tooltiptext">Reference depression of calibration orifice in in/wg</span></div><br><div id="orificeData"><h3>Orifice Data</h3><div class="config-row tooltip"><label class="config-label">Orifice #1 Flow Rate:</label>&nbsp;<input type="text" id="ORIFICE1_FLOW_RATE" name="ORIFICE1_FLOW_RATE" value="~ORIFICE1_FLOW_RATE~" class="config-text"><span class="tooltiptext">Flow rate of orifice #1 in cfm</span></div><div class="config-row tooltip"><label class="config-label">Orifice #1 Test Pressure:</label>&nbsp;<input type="text" id="ORIFICE1_TEST_PRESSURE" name="ORIFICE1_TEST_PRESSURE" value="~ORIFICE1_TEST_PRESSURE~" class="config-text"><span class="tooltiptext">Test Pressure for orifice #1 in in/wg</span></div><div class="config-row tooltip"><label class="config-label">Orifice #2 Flow Rate:</label>&nbsp;<input type="text" id="ORIFICE2_FLOW_RATE" name="ORIFICE2_FLOW_RATE" value="~ORIFICE2_FLOW_RATE~" class="config-text"><span class="tooltiptext">Flow rate of orifice #2 in cfm</span></div><div class="config-row tooltip"><label class="config-label">Orifice #2 Test Pressure:</label>&nbsp;<input type="text" id="ORIFICE2_TEST_PRESSURE" name="ORIFICE2_TEST_PRESSURE" value="~ORIFICE2_TEST_PRESSURE~" class="config-text"><span class="tooltiptext">Test Pressure for orifice #2 in in/wg</span></div><div class="config-row tooltip"><label class="config-label">Orifice #3 Flow Rate:</label>&nbsp;<input type="text" id="ORIFICE3_FLOW_RATE" name="ORIFICE3_FLOW_RATE" value="~ORIFICE3_FLOW_RATE~" class="config-text"><span class="tooltiptext">Flow rate of orifice #3 in cfm</span></div><div class="config-row tooltip"><label class="config-label">Orifice #3 Test Pressure:</label>&nbsp;<input type="text" id="ORIFICE3_TEST_PRESSURE" name="ORIFICE3_TEST_PRESSURE" value="~ORIFICE3_TEST_PRESSURE~" class="config-text"><span class="tooltiptext">Test Pressure for orifice #3 in in/wg</span></div><div class="config-row tooltip"><label class="config-label">Orifice #4 Flow Rate:</label>&nbsp;<input type="text" id="ORIFICE4_FLOW_RATE" name="ORIFICE4_FLOW_RATE" value="~ORIFICE4_FLOW_RATE~" class="config-text"><span class="tooltiptext">Flow rate of orifice #4 in cfm</span></div><div class="config-row tooltip"><label class="config-label">Orifice #4 Test Pressure:</label>&nbsp;<input type="text" id="ORIFICE4_TEST_PRESSURE" name="ORIFICE4_TEST_PRESSURE" value="~ORIFICE4_TEST_PRESSURE~" class="config-text"><span class="tooltiptext">Test Pressure for orifice #4 in in/wg</span></div><div class="config-row tooltip"><label class="config-label">Orifice #5 Flow Rate:</label>&nbsp;<input type="text" id="ORIFICE5_FLOW_RATE" name="ORIFICE5_FLOW_RATE" value="~ORIFICE5_FLOW_RATE~" class="config-text"><span class="tooltiptext">Flow rate of orifice #5 in cfm</span></div><div class="config-row tooltip"><label class="config-label">Orifice #5 Test Pressure:</label>&nbsp;<input type="text" id="ORIFICE5_TEST_PRESSURE" name="ORIFICE5_TEST_PRESSURE" value="~ORIFICE5_TEST_PRESSURE~" class="config-text"><span class="tooltiptext">Test Pressure for orifice #5 in in/wg</span></div><div class="config-row tooltip"><label class="config-label">Orifice #6 Flow Rate:</label>&nbsp;<input type="text" id="ORIFICE6_FLOW_RATE" name="ORIFICE6_FLOW_RATE" value="~ORIFICE6_FLOW_RATE~" class="config-text"><span class="tooltiptext">Flow rate of orifice #6 in cfm</span></div><div class="config-row tooltip"><label class="config-label">Orifice #6 Test Pressure:</label>&nbsp;<input type="text" id="ORIFICE6_TEST_PRESSURE" name="ORIFICE6_TEST_PRESSURE" value="~ORIFICE6_TEST_PRESSURE~" class="config-text"><span class="tooltiptext">Test Pressure for orifice #6 in in/wg</span></div><br></div><div class="float-right"><input id="save-config-button" type="submit" class="button" value="Save"></div><br><br></form><br><br><form method="POST" action="/api/savecalibration"><h2>Calibration Data</h2><div class="config-row tooltip"><label class="config-label">Calibration Offset:</label>&nbsp;<input type="text" id="FLOW_OFFSET" name="FLOW_OFFSET" value="~FLOW_OFFSET~" class="config-text"><span class="tooltiptext">Measured calibration offset</span></div><div class="config-row tooltip"><label class="config-label">Leak Test Baseline:</label>&nbsp;<input type="text" id="LEAK_CAL_BASELINE" name="LEAK_CAL_BASELINE" value="~LEAK_CAL_BASELINE~" class="config-text"><span class="tooltiptext">Baseline Offset</span></div><div class="config-row tooltip"><label class="config-label">Leak Test Offset:</label>&nbsp;<input type="text" id="LEAK_CAL_OFFSET" name="LEAK_CAL_OFFSET" value="~LEAK_CAL_OFFSET~" class="config-text"><span class="tooltiptext">Measured leak test value</span></div><div class="config-row tooltip"><label class="config-label">Leak Test Baseline (Reverse):</label>&nbsp;<input type="text" id="LEAK_CAL_BASELINE_REV" name="LEAK_CAL_BASELINE_REV" value="~LEAK_CAL_BASELINE_REV~" class="config-text"><span class="tooltiptext">Baseline Offset (Reverse Flow)</span></div><div class="config-row tooltip"><label class="config-label">Leak Test Offset (Reverse):</label>&nbsp;<input type="text" id="LEAK_CAL_OFFSET_REV" name="LEAK_CAL_OFFSET_REV" value="~LEAK_CAL_OFFSET_REV~" class="config-text"><span class="tooltiptext">Measured leak test value (Reverse Flow)</span></div><br><div class="float-right"><input id="save-config-button" type="submit" class="button" value="Overwrite"></div></form></div></div></div><div id="footer"><a href="https://diyflowbench.com" target="new">DIYFlowBench.com</a></div><script>/***********************************************************
* javascript.js
*
* Browser control code for DIY-Flow-bench project: diyflowbench.com
* Handles data transmission and display update tasks
* Provides UI control to browser
*
***/

var leakCalVal;
var flowCalVal;
var leakCalTolerance;
var leakTestThreshold;
var updateSSE = true;
var active_orifice;
var runOnce = false;

window.addEventListener('load', onLoad);

var fileModal = document.getElementById("fileModal");
var infoModal = document.getElementById("infoModal");
var captureLiftDataModal = document.getElementById("captureLiftDataModal");
var loadGraphDataModal = document.getElementById("loadGraphDataModal");
var saveGraphDataModal = document.getElementById("saveGraphDataModal");
var calibrationModal = document.getElementById("calibrationModal");
var updateModal = document.getElementById("updateModal");
var flowTargetModal = document.getElementById("flowTargetModal");


var closeFlowTargetModalButton = document.getElementsByClassName("closeFlowTargetModalButton")[0];
var closeCalibrationModalButton = document.getElementsByClassName("closeCalibrationModalButton")[0];
var closeFileModalButton = document.getElementsByClassName("closeFileModalButton")[0];
var closeInfoModalButton = document.getElementsByClassName("closeInfoModalButton")[0];
var closeCaptureLiftDataModalButton = document.getElementsByClassName("closeCaptureLiftDataModalButton")[0];
var closeLoadGraphDataModalButton = document.getElementsByClassName("closeLoadGraphDataModalButton")[0];
var closeSaveGraphDataModalButton = document.getElementsByClassName("closeSaveGraphDataModalButton")[0];
var closeCalibrationModalButton = document.getElementsByClassName("closeCalibrationModalButton")[0];
var closeUpdateModalButton = document.getElementsByClassName("closeUpdateModalButton")[0];

// Set up Server Side Events (SSE)
if (!!window.EventSource) {
  var source = new EventSource('/events');

  source.addEventListener('JSON_DATA', function(e) {
    var myObj = JSON.parse(e.data);

    if (updateSSE === true){

      for (key in myObj) {
        try {
          if (typeof myObj[key] === 'string' || myObj[key] instanceof String) {
            document.getElementById(key).innerHTML = myObj[key];
          } else {
            if (key === 'FLOW' || key === 'AFLOW' || key === 'MFLOW' || key === 'FDIFF'){
              //HACK: template vars - replaced before page load
              document.getElementById(key).innerHTML = myObj[key].toFixed(~FLOW_DECIMAL_LENGTH~);  
            } else {
              document.getElementById(key).innerHTML = myObj[key].toFixed(~GEN_DECIMAL_LENGTH~); 
            }
          }
        } catch (error) {
          console.log('Missing or incorrect JSON data');
          console.log(error);
          console.log(key);
        }
      } 

      // get bench type and set up GUI accoordingly
      var benchType = myObj["BENCH_TYPE"];

      // get active orifice and set up GUI accoordingly
      active_orifice = myObj["ACTIVE_ORIFICE"];
      if (runOnce == false ){
        radioButton = document.getElementById("orifice" + active_orifice);
        radioButton.checked = true;
      }

      switch (benchType) {
    
        case "MAF":
          document.getElementById('orificeData').style.display='none';
          document.getElementById('orificeRadio').style.display='none';
        break;
    
        case "ORIFICE":
          document.getElementById('orificeData').style.display='block';
          document.getElementById('orificeRadio').style.display='block';
        break;
          
        case "VENTURI":
          document.getElementById('orificeData').style.display='block';
        break;
          
        case "PITOT":
          document.getElementById('orificeData').style.display='block';
        break;
          
      }

      // Get data filter type
      var dataFilterType = myObj["DATA_FILTER_TYPE"];


    }

  }, false);



}



/***********************************************************
* onFileUpload event handler
***/
function onFileUpload(event) {
  this.setState({file: event.target.files[0]});
  const {file} = this.state;
  const data = new FormData;
  data.append('data', file);
  fetch('/upload', {
      method: 'POST',
      body: data
  })
      .catch(e => {
          console.log('Request failed', e);
      });
}



/***********************************************************
* onLoad event handler
***/
function onLoad(event) {

  initialiseButtons();
  const urlParams = new URLSearchParams(window.location.search);
  const view = urlParams.get('view');  
  
  switch (view) {
  
    case "upload":
      document.getElementById("load-config-button").click();
      document.getElementById('fileModal').style.display='block';
    break;

    case "graph":
      document.getElementById("load-datalog-button").click();
      document.getElementById('datalog').style.display='block';
    break;
      
    case "config":
      document.getElementById("load-config-button").click();
    break;
      
    
  }
 
  console.log('Page Loaded');
  
}



/***********************************************************
* Initialise buttons
***/
function initialiseButtons() {
  
  var xhr = new XMLHttpRequest();

  document.getElementById('show-capture-modal-button').addEventListener('click', function(){
    document.getElementById('captureLiftDataModal').style.display='block';
  });

  document.getElementById('FDIFF').addEventListener('click', function(){
    document.getElementById('flowTargetModal').style.display='block';
  });

  document.getElementById('clear-graph-data-button').addEventListener('click', function(){
        
    // clear data points from graph
    // var p = document.getElementById('dataPlot');
    // var child = p.lastElementChild; 
    // while (child) {
    //     p.removeChild(child);
    //     child = p.lastElementChild;
    // }
    // clear line data from graph
    var l = document.getElementById('lineData');
    var child = l.lastElementChild; 
    while (child) {
        l.removeChild(child);
        child = l.lastElementChild;
    }

    xhr.open('POST', '/api/clearLiftData');
    xhr.onload = function() {
      if (xhr.status === 200) window.location.href = '/?view=graph';
    };
    xhr.send();

  });
  
  document.getElementById('export-graph-data-button').addEventListener('click', function(){
    // initiate JSON Data download from browser
    document.getElementById('file-data-download').click();
  });

  document.getElementById('capture-graph-data-button').addEventListener('click', function(){
    // initiate datagraph image download from browser
    exportSVGAsPNG();
  });

  document.getElementById('STATUS_MESSAGE').addEventListener('dblclick', function(){
    document.getElementById('calibrationModal').style.display='block';
  });

  document.getElementById('file-manager-button').addEventListener('click', function(){
    document.getElementById('fileModal').style.display='block';
  });

  document.getElementById('info-button').addEventListener('click', function(){
    document.getElementById('infoModal').style.display='block';
  });

  document.getElementById('update-button').addEventListener('click', function(){
    document.getElementById('updateModal').style.display='block';
  });

  document.getElementById('tile-pref-title').addEventListener('click', function(){
    document.getElementById('tile-pref').style.display='none';
    document.getElementById('tile-pdiff').style.display='block';
  });

  document.getElementById('tile-pdiff-title').addEventListener('click', function(){
    document.getElementById('tile-pdiff').style.display='none';
    document.getElementById('tile-pref').style.display='block';
  });

  document.getElementById('flow-tile-title').addEventListener('click', function(){
    document.getElementById('flow-tile').style.display='none';
    document.getElementById('aflow-tile').style.display='block';
  });

  document.getElementById('aflow-tile-title').addEventListener('click', function(){
    document.getElementById('aflow-tile').style.display='none';
    document.getElementById('maf-tile').style.display='block';
  });

  document.getElementById('maf-tile-title').addEventListener('click', function(){
    document.getElementById('maf-tile').style.display='none';
    document.getElementById('flow-tile').style.display='block';
  });
  document.getElementById('tile-pitot-title').addEventListener('click', function(){
    document.getElementById('tile-pitot').style.display='none';
    document.getElementById('tile-swirl').style.display='block';

  });

  document.getElementById('tile-swirl-title').addEventListener('click', function(){
    document.getElementById('tile-swirl').style.display='none';
    document.getElementById('tile-fdiff').style.display='block';
  });

  document.getElementById('tile-fdiff-title').addEventListener('click', function(){
    document.getElementById('tile-fdiff').style.display='none';
    document.getElementById('tile-pitot').style.display='block';
  });

  document.getElementById('FDIFFTYPEDESC').addEventListener('click', function(){
    console.log('Toggle Flow Diff');
    xhr.open('GET', '/api/fdiff');
    // xhr.onload = function() {
    //   if (xhr.status === 200) window.location.href = '/';
    // };
    xhr.send();
  });

  document.getElementById('on-button').addEventListener('click', function(){
    console.log('Bench On');
    xhr.open('GET', '/api/bench/on');
    xhr.onload = function() {
      if (xhr.status === 200) window.location.href = '/';
    };
    xhr.send();
  });

  document.getElementById('off-button').addEventListener('click', function(){
    console.log('Bench Off');
    xhr.open('GET', '/api/bench/off');
    xhr.onload = function() {
      if (xhr.status === 200) window.location.href = '/';
    };
    xhr.send();
  });

  document.getElementById('calibrate-button').addEventListener('click', function(){
    console.log('Calibrate FLow Offset');
    xhr.open('GET', '/api/bench/calibrate');
    xhr.onload = function() {
      if (xhr.status === 200) window.location.href = '/?view=config';
    };
    xhr.send();
  });

  document.getElementById('leak-cal-button').addEventListener('click', function(){
    console.log('Leak Test Calibration');
    xhr.open('GET', '/api/bench/leakcal');
    xhr.onload = function() {
      if (xhr.status === 200) window.location.href = '/?view=config';
    };
    xhr.send();
  });

  document.getElementById('clear-message-button').addEventListener('click', function(){
    console.log('Clear Message');
    xhr.open('GET', '/api/clear-message');
    xhr.onload = function() {
      if (xhr.status === 200) window.location.href = '/';
    };
    xhr.send();
  });

  document.getElementById('restart-button').addEventListener('click', function(){
    console.log('System Reboot');
    xhr.open('GET', '/api/bench/reboot');
    xhr.onload = function() {
      if (xhr.status === 200) window.location.href = '/';
    };
    xhr.send();
  });



}


/***********************************************************
* Update selected orifice when orifice-radio button change
***/
function orificeChange(src) {
  
  var xhr = new XMLHttpRequest();

  console.log('Orifice ' + src.value + ' Selected');

  xhr.open('GET', '/api/orifice-change?orifice=' + src.value);
  xhr.onload = function() {
//    if (xhr.status === 200) window.location.href = '/';
  };
  xhr.send();
  }




/***********************************************************
* Page tab control
***/
function openTab(tabName, elmnt) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  document.getElementById(tabName).style.display = "block";
  // Pause SSE update when on data tab
  if (tabName === "datalog") {
    updateSSE = false;
  } else {
    updateSSE = true;
  }
}

/***********************************************************
* Close update modal dialog
***/
closeUpdateModalButton.onclick = function() {
  updateModal.style.display = "none";
}

/***********************************************************
* Close calibration modal dialog
***/
closeCalibrationModalButton.onclick = function() {
  calibrationModal.style.display = "none";
}

/***********************************************************
* Close file modal dialog
***/
closeFileModalButton.onclick = function() {
  fileModal.style.display = "none";
}

/***********************************************************
* Close info modal dialog
***/
closeInfoModalButton.onclick = function() {
  infoModal.style.display = "none";
}


/***********************************************************
* Close Capture Data modal dialog
***/
closeCaptureLiftDataModalButton.onclick = function() {
  captureLiftDataModal.style.display = "none";
}


/***********************************************************
* Close Load Data modal dialog
***/
closeLoadGraphDataModalButton.onclick = function() {
  loadGraphDataModal.style.display = "none";
}


/***********************************************************
* Close Save Data modal dialog
***/
closeSaveGraphDataModalButton.onclick = function() {
  saveGraphDataModal.style.display = "none";
}

/***********************************************************
* Close Flow Target Data modal dialog
***/
closeFlowTargetModalButton.onclick = function() {
  flowTargetModal.style.display = "none";
}



/***********************************************************
* Close modal dialogs on lose focus
***/
window.onclick = function(event) {
  if (event.target == fileModal || event.target == infoModal || event.target == captureLiftDataModal || event.target == loadGraphDataModal || event.target == saveGraphDataModal || event.target == calibrationModal || event.target == updateModal || event.target == flowTargetModal  ){
    fileModal.style.display = "none";
    infoModal.style.display = "none";
    captureLiftDataModal.style.display = "none";
    loadGraphDataModal.style.display = "none";
    saveGraphDataModal.style.display = "none";
    calibrationModal.style.display = "none";
    updateModal.style.display = "none";
    flowTargetModal.style.display = "none";
  }
}


/***********************************************************
* Close modal dialogs on esc button
***/
document.addEventListener("keydown", ({key}) => {
  if (key === "Escape") {
    fileModal.style.display = "none";
    infoModal.style.display = "none";
    captureLiftDataModal.style.display = "none";
    loadGraphDataModal.style.display = "none";
    saveGraphDataModal.style.display = "none";
    calibrationModal.style.display = "none";
    updateModal.style.display = "none";
    flowTargetModal.style.display = "none";
  }
})



/***********************************************************
* Export Data Graph as PNG Image
* Source: https://takuti.me/note/javascript-save-svg-as-image/
***/
function exportSVGAsPNG() {

  const svg = document.querySelector('svg');

  const data = (new XMLSerializer()).serializeToString(svg);
  const svgBlob = new Blob([data], {
      type: 'image/svg+xml;charset=utf-8'
  });

  // convert the blob object to a dedicated URL
  const url = URL.createObjectURL(svgBlob);

  // load the SVG blob to a flesh image object
  const img = new Image();
  img.addEventListener('load', () => {
    
    // draw the image on an ad-hoc canvas
    const bbox = svg.getBBox();

    const canvas = document.createElement('canvas');
    canvas.width = 800;
    canvas.height = 750;

    const context = canvas.getContext('2d');
    context.drawImage(img, 0, 0, canvas.width, canvas.height);

    URL.revokeObjectURL(url);

    // trigger a synthetic download operation with a temporary link
    const a = document.createElement('a');
    a.download = 'LiftGraph.png';
    document.body.appendChild(a);
    a.href = canvas.toDataURL();
    a.click();
    a.remove();

  });
  img.src = url;

}</script></body></html>