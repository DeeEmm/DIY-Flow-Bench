<!DOCTYPE HTML><html lang="en"><head><title>DIY Flow Bench</title><meta name="viewport" content="width=device-width,initial-scale=1"><style>body,html{height:100vh;margin:0;font-family:Arial;font-size:22px}.tablink{background-color:#555;color:#fff;float:left;border:none;outline:0;cursor:pointer;padding:18px 1pc;font-size:22px;width:50vw}.tablink:active,.tablink:hover{background-color:#777}.tabcontentConfig,.tabcontentMain{padding:75pt 20px;height:100vh}.tabcontentConfig{display:none}#About,#Contact,#Home,#News{background-color:#fff}html{font-family:Helvetica;display:inline-block;margin:0 auto}.headerbar{overflow:hidden;background-color:#0a1128;text-align:center}.headerbar h1 a:active,.headerbar h1 a:hover,.headerbar h1 a:link,.headerbar h1 a:visited{color:#fff;text-decoration:none}h1{color:#fff}p{font-size:1.5rem}a:active,a:link,a:visited{color:#0a1128;text-decoration:none}a:hover{color:#666;text-decoration:none}hr{clear:both}.content{padding:30px}.float-right{float:right}.align-center{text-align:center}.clear-both{clear:both}.tile-grid{max-width:700px;margin:0 auto;display:grid;grid-gap:2rem;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr))}.tile{background-color:#fff;box-shadow:2px 2px 9pt 1px #666;text-align:center}.tile-title{font-size:1rem;font-weight:700;color:#034078}.tile-value{font-size:2.1rem;font-weight:700;color:#333}.tile-pdiff{display:none}.tile-pitot{display:block}.config-panel{max-width:650px;margin:auto}.config-row{margin-top:5px}.config-label{padding-left:5px}.config-value{padding-right:50px;width:300px;float:right}.config-text{width:200px;float:right}.config-select{width:41.5vw;float:right}.units{font-size:.8rem;color:#666}.status_message{font-size:1.2rem;color:#666}#footer{clear:both;text-align:center}.hidden_div{display:none}.control-button{height:70px}.button,.control-button{display:inline-block;padding:9pt;font-size:22px;width:150px}.button,.button-sml,.control-button{background-color:#008cba;border:none;border-radius:4px;color:#fff;text-decoration:none;margin:2px;cursor:pointer}.button-sml{float:right;padding:6px;font-size:9pt}#record-button{background-color:#fa2e04}#save-button{background-color:#44b112}#calibrate-button{background-color:#fa2e04}#file-manager-button,#info-button,#restart-button,#support-button{width:90pt;height:50px}#on-button{background-color:#44b112}#delete-button,#off-button,#restart-button{background-color:#fa2e04}#upload-form{float:right}.tooltip{position:relative;border-bottom:1px dotted #000}.tooltip .tooltiptext{visibility:hidden;width:350px;background-color:#666;color:#fff;text-align:center;border-radius:6px;padding:5px;position:absolute;z-index:1;left:-10px;top:-5px}.tooltip .tooltiptext:after{content:"";position:absolute;top:100vh;left:50vw;margin-left:-5px;border-width:5px;border-style:solid;border-color:#000 transparent transparent}.tooltip:hover .tooltiptext{visibility:visible}.modal{display:none;position:fixed;z-index:1;left:0;padding-top:50px;width:100vw;height:100vh;overflow:auto;background-color:#000;background-color:rgba(0,0,0,.4)}.modal-content{background-color:#fefefe;margin:1px auto;padding:20px;border:1px solid #888;width:850px;border-radius:5px}@media screen and (max-width:800px){.modal-content{width:100vw}}.file-upload-button{padding:9pt 0;text-align:center}input[type=file]{display:none}.closeFileModalButton,.closeInfoModalButton{color:#aaa;float:right;font-size:22px;font-weight:700;cursor:pointer}.closeFileModalButton:focus,.closeFileModalButton:hover,.closeInfoModalButton:focus,.closeInfoModalButton:hover{color:#000;text-decoration:none;cursor:pointer}.fileSizeTxt{padding:10px}.fileDelLink{padding:10px;left:75pt}.file-link,.fileDelLink{cursor:pointer}.fileListRow{margin-bottom:10px}.column{float:left;height:40px}.left{width:350px;height:40px}.middle{width:200px}.right{width:75pt}.row:after{content:"";display:table;clear:both}.graph-container{margin-top:50px;text-align:center}svg.graph{height:500px;width:50pc}svg.graph .grid{stroke:grey;stroke-dasharray:1 2;stroke-width:1}svg.graph .points{stroke:#fff;stroke-width:3}svg.graph .first_set{fill:#00554d}svg.graph .surfaces{fill-opacity:.5}svg.graph .grid.double{stroke-opacity:.4}svg.graph .labels{font-family:Arial;font-size:14px;kerning:1}svg.graph .labels.x-labels{text-anchor:middle}svg.graph .labels.y-labels{text-anchor:end}.prefTestOK{color:#90ee90}.prefTestNOK,.prefTestOK{font-size:2.1rem;font-weight:700}.prefTestNOK{color:red}</style></head><body><div id="fileModal" class="modal"><div class="modal-content"><span class="closeFileModalButton">&times;</span><h3>File Manager</h3><div id="file_list">%FILE_LIST%</div><br><hr><br><div class="float-right"><form method="POST" action="/api/file/upload" enctype="multipart/form-data"><label for="data" class="file-upload-button button">Select File</label> <input id="data" type="file" name="wtf"> <input class="button file-submit-button" type="submit" value="Upload"></form></div><div class="clear-both">&nbsp;</div></div></div><div id="infoModal" class="modal"><div class="modal-content"><span class="closeInfoModalButton">&times;</span><h3>DIY Flow Bench</h3><h4>Firmware</h4><hr><div class="config-row"><label class="config-label">Version:</label><span class="config-value" id="RELEASE">%RELEASE%</span></div><div class="config-row"><label class="config-label">Build:</label><span class="config-value" id="BUILD_NUMBER">%BUILD_NUMBER%</span></div><h4>Storage</h4><hr><div class="config-row"><label class="config-label">Memory Size:</label><span class="config-value" id="SPIFFS_MEM_SIZE">%SPIFFS_MEM_SIZE%</span> (bytes)</div><div class="config-row"><label class="config-label">Memory Used:</label><span class="config-value" id="SPIFFS_MEM_USED">%SPIFFS_MEM_USED%</span> (bytes)</div><h4>Network</h4><hr><div class="config-row"><label class="config-label">IP Address:</label><span class="config-value" id="LOCAL_IP_ADDRESS">%LOCAL_IP_ADDRESS%</span></div><div class="config-row"><label class="config-label">Hostname:</label><span class="config-value" id="HOSTNAME">http://%HOSTNAME%.local</span></div><h4>Hardware Configuration</h4><hr><div class="config-row"><label class="config-label">Bench Type:</label><span class="config-value" id="BENCHTYPE">%BENCHTYPE%</span></div><div class="config-row"><label class="config-label">Board Type:</label><span class="config-value" id="BOARDTYPE">%BOARDTYPE%</span></div><h4>Sensor Configuration</h4><hr><div class="config-row"><label class="config-label">MAF Data File:</label><span class="config-value" id="MAF_SENSOR">%MAF_SENSOR%</span></div><div class="config-row"><label class="config-label">Ref Press Sensor:</label><span class="config-value" id="PREF_SENSOR">%PREF_SENSOR%</span></div><div class="config-row"><label class="config-label">Temp Sensor:</label><span class="config-value" id="TEMP_SENSOR">%TEMP_SENSOR%</span></div><div class="config-row"><label class="config-label">Humidity Sensor:</label><span class="config-value" id="RELH_SENSOR">%RELH_SENSOR%</span></div><div class="config-row"><label class="config-label">Baro Sensor:</label><span class="config-value" id="BARO_SENSOR">%BARO_SENSOR%</span></div><div class="config-row"><label class="config-label">Pitot Sensor:</label><span class="config-value" id="PITOT_SENSOR">%PITOT_SENSOR%</span></div><div class="config-row"><label class="config-label">Differential Sensor:</label><span class="config-value" id="PDIFF_SENSOR">%PDIFF_SENSOR%</span></div></div></div><div class="headerbar"><h1><a href="/" id="PAGE_TITLE" alt="DIY Flow Bench">DIY Flow Bench</a></h1></div><button class="tablink" onclick="openTab('dashboard', this)" id="load-dashboard-button">Dashboard</button> <button class="tablink" onclick="openTab('configuration', this)" id="load-config-button">Configuration</button><div id="dashboard" class="tabcontent tabcontentMain"><div class="content"><div class="tile-grid"><div class="tile tile-pref"><p class="tile-title">Ref Pressure</p><p><span class="tile-value" id="PREF">&nbsp;</span></p><p class="units">In/Aq</p></div><div class="tile tile-flow"><p class="tile-title">Flow Rate</p><p><span class="tile-value" id="FLOW">&nbsp;</span></p><p class="units">cfm</p></div><div class="tile tile-pdiff"><p class="tile-title">Diff Pressure</p><p><span class="tile-value" id="PDIFF">&nbsp;</span></p><p class="units">In/Aq</p></div><div class="tile tile-pitot"><p class="tile-title">Pitot</p><p><span class="tile-value" id="PITOT">&nbsp;</span></p><p class="units">In/Aq</p></div><div class="tile tile-temp"><p class="tile-title">Temperature</p><p><span class="tile-value" id="TEMP">&nbsp;</span></p><p class="units">Deg</p></div><div class="tile tile-baro"><p class="tile-title">Baro Pressure</p><p><span class="tile-value" id="BARO">&nbsp;</span></p><p class="units">millibar (hPa)</p></div><div class="tile tile-relh"><p class="tile-title">Humidity</p><p><span class="tile-value" id="RELH">&nbsp;</span></p><p class="units">&percnt;RH</p></div></div></div><div class="align-center"><div class="status_message"><span id="STATUS_MESSAGE">%STATUS_MESSAGE%</span></div><div class="hidden_div"><br>Ref Pressure mV: <span id="PREF_MV">&nbsp;</span><br>MAF mV: <span id="MAF_MV">&nbsp;</span><br>Pitot mV: <span id="PITOT_MV">&nbsp;</span></div><p><button id="on-button" class="control-button">START BENCH</button> <button id="off-button" class="control-button">STOP BENCH</button> <button id="clear-message-button" class="control-button">CLEAR MESSAGE</button></p></div><br><div id="footer"><a href="https://diyflowbench.com" target="new">DIYFlowBench.com</a></div></div><div id="configuration" class="tabcontent tabcontentConfig"><div class="config-panel"><p style="text-align:center"><button id="file-manager-button" class="button">Files</button> <button id="info-button" class="button">Info</button> <button id="support-button" class="button" onclick="window.open('https://github.com/DeeEmm/DIY-Flow-Bench/wiki','_blank')">Support</button> <button id="restart-button" class="button">Reboot</button></p><br><form method="POST" action="/api/saveconfig"><h3>WiFi Info</h3><div class="config-row tooltip"><label class="config-label">WiFi SSID:</label>&nbsp;<input type="text" id="CONF_WIFI_SSID" name="CONF_WIFI_SSID" value="%CONF_WIFI_SSID%" class="config-text"><span class="tooltiptext">The name of your WiFi network</span></div><div class="config-row tooltip"><label class="config-label">WiFi Password:</label>&nbsp;<input type="text" id="CONF_WIFI_PSWD" name="CONF_WIFI_PSWD" value="%CONF_WIFI_PSWD%" class="config-text"><span class="tooltiptext">Your WiFi Password</span></div><div class="config-row tooltip"><label class="config-label">WiFi AP SSID:</label>&nbsp;<input type="text" id="CONF_WIFI_AP_SSID" name="CONF_WIFI_AP_SSID" value="%CONF_WIFI_AP_SSID%" class="config-text"><span class="tooltiptext">Access-point name for direct WiFi connection</span></div><div class="config-row tooltip"><label class="config-label">WiFi AP Password:</label>&nbsp;<input type="text" id="CONF_WIFI_AP_PSWD" name="CONF_WIFI_AP_PSWD" value="%CONF_WIFI_AP_PSWD%" class="config-text"><span class="tooltiptext">Access-point password</span></div><div class="config-row tooltip"><label class="config-label">Hostname:</label>&nbsp;<input type="text" id="CONF_HOSTNAME" name="CONF_HOSTNAME" value="%CONF_HOSTNAME%" class="config-text"><span class="tooltiptext">DNS Hostname (used for connecting via URL e.g. http://diyfb.local)</span></div><div class="config-row tooltip"><label class="config-label">WiFi Timeout:</label>&nbsp;<input type="text" id="CONF_WIFI_TIMEOUT" name="CONF_WIFI_TIMEOUT" value="%CONF_WIFI_TIMEOUT%" class="config-text"><span class="tooltiptext">Number of milliseconds before WiFi defaults to Access-point mode</span></div><br><h3>API Settings</h3><div class="config-row tooltip"><label class="config-label">API Delimiter:</label>&nbsp;<input type="text" id="CONF_API_DELIM" name="CONF_API_DELIM" value="%CONF_API_DELIM%" class="config-text"><span class="tooltiptext">Character used to delimit API / Serial data</span></div><div class="config-row tooltip"><label class="config-label">Serial Baud Rate:</label>&nbsp;<input type="text" id="CONF_SERIAL_BAUD_RATE" name="CONF_SERIAL_BAUD_RATE" value="%CONF_SERIAL_BAUD_RATE%" class="config-text"><span class="tooltiptext">Baud rate for serial communication</span></div><br><h3>Data Filters</h3><div class="config-row tooltip"><label class="config-label">Min Flow Rate:</label>&nbsp;<input type="text" id="CONF_MIN_FLOW_RATE" name="CONF_MIN_FLOW_RATE" value="%CONF_MIN_FLOW_RATE%" class="config-text"><span class="tooltiptext">Used to filter out non-zero flow values when bench is not running</span></div><div class="config-row tooltip"><label class="config-label">Min Bench Pressure:</label>&nbsp;<input type="text" id="CONF_MIN_BENCH_PRESSURE" name="CONF_MIN_BENCH_PRESSURE" value="%CONF_MIN_BENCH_PRESSURE%" class="config-text"><span class="tooltiptext">Minimum reference pressure that bench is considered running</span></div><div class="config-row tooltip"><label class="config-label">MAF Min volts:</label>&nbsp;<input type="text" id="CONF_MAF_MIN_VOLTS" name="CONF_MAF_MIN_VOLTS" value="%CONF_MAF_MIN_VOLTS%" class="config-text"><span class="tooltiptext">Minimum MAF voltage that bench is considered running</span></div><div class="config-row tooltip"><label class="config-label">Cyclical Average Buffer:</label>&nbsp;<input type="text" id="CONF_CYCLIC_AVERAGE_BUFFER" name="CONF_CYCLIC_AVERAGE_BUFFER" value="%CONF_CYCLIC_AVERAGE_BUFFER%" class="config-text"><span class="tooltiptext">Mean buffer size - Used for smoothing results.</span></div><br><h3>Bench Settings</h3><div class="config-row tooltip"><label class="config-label">Refresh Rate:</label>&nbsp;<input type="text" id="CONF_REFRESH_RATE" name="CONF_REFRESH_RATE" value="%CONF_REFRESH_RATE%" class="config-text"><span class="tooltiptext">Screen refresh rate in milliseconds</span></div><br><h3>Calibration Settings</h3><div class="config-row tooltip"><label class="config-label">Orifice Flow Rate:</label>&nbsp;<input type="text" id="CONF_CAL_FLOW_RATE" name="CONF_CAL_FLOW_RATE" value="%CONF_CAL_FLOW_RATE%" class="config-text"><span class="tooltiptext">Flow rate of calibration orifice in cfm</span></div><div class="config-row tooltip"><label class="config-label">Orifice Test Pressure:</label>&nbsp;<input type="text" id="CONF_CAL_REF_PRESS" name="CONF_CAL_REF_PRESS" value="%CONF_CAL_REF_PRESS%" class="config-text"><span class="tooltiptext">Reference depression of calibration orifice in in/wg</span></div><div class="config-row tooltip"><label class="config-label">Leak Test Tolerance:</label>&nbsp;<input type="text" id="CONF_LEAK_TEST_TOLERANCE" name="CONF_LEAK_TEST_TOLERANCE" value="%CONF_LEAK_TEST_TOLERANCE%" class="config-text"><span class="tooltiptext">Maximum allowable deviation in cfm</span></div><div class="config-row tooltip"><label class="config-label">Leak Test Threshold:</label>&nbsp;<input type="text" id="CONF_LEAK_TEST_THRESHOLD" name="CONF_LEAK_TEST_THRESHOLD" value="%CONF_LEAK_TEST_THRESHOLD%" class="config-text"><span class="tooltiptext">Depression value above which leak test activates</span></div><br><div class="float-right"><input id="save-config-button" type="submit" class="button" value="Save"></div></form><br><br><h3>Calibration Data</h3><div class="config-row tooltip"><label class="config-label">Calibration Offset:</label>&nbsp;<input disabled="disabled" type="text" id="FLOW_OFFSET" name="FLOW_OFFSET" value="%FLOW_OFFSET%" class="config-text"><span class="tooltiptext">Measured calibration offset</span></div><div class="config-row tooltip"><label class="config-label">Leak Test Value:</label>&nbsp;<input disabled="disabled" type="text" id="LEAK_CAL_VAL" name="LEAK_CAL_VAL" value="%LEAK_CAL_VAL%" class="config-text"><span class="tooltiptext">Measured leak test value</span></div><br><div class="float-right"><button id="calibrate-button" class="button">Calibrate Flow Offset</button><button id="leak-cal-button" class="button">Calibrate Leak Test</button></div><br></div></div><script>var leakCalVal,flowCalVal,leakCalTolerance,leakTestThreshold;window.addEventListener("load",onLoad);var fileModal=document.getElementById("fileModal"),infoModal=document.getElementById("infoModal"),closeFileModalButton=document.getElementsByClassName("closeFileModalButton")[0],closeInfoModalButton=document.getElementsByClassName("closeInfoModalButton")[0];if(window.EventSource){var source=new EventSource("/events");source.addEventListener("FLOW",(function(e){document.getElementById("FLOW").innerHTML=e.data}),!1),source.addEventListener("PREF",(function(e){document.getElementById("PREF").innerHTML=e.data}),!1),source.addEventListener("PITOT",(function(e){document.getElementById("PITOT").innerHTML=e.data}),!1),source.addEventListener("PDIFF",(function(e){document.getElementById("PDIFF").innerHTML=e.data}),!1),source.addEventListener("TEMP",(function(e){document.getElementById("TEMP").innerHTML=e.data}),!1),source.addEventListener("RELH",(function(e){document.getElementById("RELH").innerHTML=e.data}),!1),source.addEventListener("BARO",(function(e){document.getElementById("BARO").innerHTML=e.data}),!1),source.addEventListener("STATUS_MESSAGE",(function(e){document.getElementById("STATUS_MESSAGE").innerHTML=e.data}),!1),source.addEventListener("PING",(function(e){console.log("PING",e.data)}),!1)}function onFileUpload(e){this.setState({file:e.target.files[0]});const{file:n}=this.state,t=new FormData;t.append("data",n),fetch("/upload",{method:"POST",body:t}).catch((e=>{console.log("Request failed",e)}))}function onLoad(e){initialiseButtons();switch(new URLSearchParams(window.location.search).get("view")){case"upload":document.getElementById("load-config-button").click(),document.getElementById("fileModal").style.display="block";break;case"config":document.getElementById("load-config-button").click()}console.log("Page Loaded")}function initialiseButtons(){var e=new XMLHttpRequest;document.getElementById("file-manager-button").addEventListener("click",(function(){document.getElementById("fileModal").style.display="block"})),document.getElementById("info-button").addEventListener("click",(function(){document.getElementById("infoModal").style.display="block"})),document.getElementById("on-button").addEventListener("click",(function(){console.log("Bench On"),e.open("GET","/api/bench/on"),e.onload=function(){200===e.status&&(window.location.href="/")},e.send()})),document.getElementById("off-button").addEventListener("click",(function(){console.log("Bench Off"),e.open("GET","/api/bench/off"),e.onload=function(){200===e.status&&(window.location.href="/")},e.send()})),document.getElementById("calibrate-button").addEventListener("click",(function(){console.log("Calibrate FLow Offset"),e.open("GET","/api/bench/calibrate"),e.onload=function(){200===e.status&&(window.location.href="/")},e.send()})),document.getElementById("leak-cal-button").addEventListener("click",(function(){console.log("Leak Test Calibration"),e.open("GET","/api/bench/leakcal"),e.onload=function(){200===e.status&&(window.location.href="/")},e.send()})),document.getElementById("clear-message-button").addEventListener("click",(function(){console.log("Clear Message"),e.open("GET","/api/clear-message"),e.onload=function(){200===e.status&&(window.location.href="/")},e.send()})),document.getElementById("restart-button").addEventListener("click",(function(){console.log("System Reboot"),e.open("GET","/api/bench/reboot"),e.onload=function(){200===e.status&&(window.location.href="/")},e.send()}))}function openTab(e,n){var t,o;for(o=document.getElementsByClassName("tabcontent"),t=0;t<o.length;t++)o[t].style.display="none";document.getElementById(e).style.display="block"}closeFileModalButton.onclick=function(){fileModal.style.display="none"},closeInfoModalButton.onclick=function(){infoModal.style.display="none"},window.onclick=function(e){e.target!=fileModal&&e.target!=infoModal||(fileModal.style.display="none",infoModal.style.display="none")},document.addEventListener("keydown",(({key:e})=>{"Escape"===e&&(fileModal.style.display="none",infoModal.style.display="none")}));</script></body></html>